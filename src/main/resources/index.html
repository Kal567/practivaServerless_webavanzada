<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <!-- Required Stylesheets -->
    <link
            type="text/css"
            rel="stylesheet"
            href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"
    />
    <link
            type="text/css"
            rel="stylesheet"
            href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"
    />

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <title>Ejemplo CRUD con VueJS</title>
</head>
<body>

<div class="container" id="app">
    <div class="row mt-3">
        <div class="col-sm">
            <h1 class="text-center">Lab Reservations</h1>
            <div>
                <b-button variant="outline-primary" v-b-modal.modal-1 @click="nuevoEstudiante">Create New Reservation</b-button>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-sm">
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Matrícula</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Schedule</th>
                    <th scope="col">Options</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="reservation in reservations">
                    <td>{{reservation.matricula}}</td>
                    <td>{{reservation.name}}</td>
                    <td>{{reservation.email}}</td>
                    <td>{{reservation.schedule}}</td>
                    <td>
                        <button class="btn btn-secondary" @click="editarEstudiante(reservation)">Edit</button> |
                        <button class="btn btn-danger" @click="eliminarEstudiante(reservation)">Delete</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <b-modal id="modal-1" hide-footer :title="titulo">
        <b-form @submit.prevent="crearActualizarEstudiante" @reset="limpiar" >

            <!-- Matricula       -->
            <b-form-group
                    label="Matrícula"
                    label-for="g1">
                <b-form-input
                        id = "g1"
                        v-model="nuevo.matricula"
                        type="number"
                        required
                        placeholder="Matrícula"
                ></b-form-input>
            </b-form-group>

            <!-- Nombre            -->
            <b-form-group
                    label="Name:"
                    label-for="g3">
                <b-form-input
                        id = "g3"
                        v-model="nuevo.nombre"
                        type="text"
                        required
                        placeholder="Name"
                ></b-form-input>
            </b-form-group>

            <!-- Carrera            -->
            <b-form-group
                    label="Email:"
                    label-for="g3">
                <b-form-input
                        id = "g3"
                        v-model="nuevo.carrera"
                        type="text"
                        required
                        placeholder="Email"
                ></b-form-input>
            </b-form-group>

            <!-- Carrera            -->
            <b-form-group
                    label="Schedule:"
                    label-for="g3">
                <b-form-input
                        id = "g3"
                        v-model="nuevo.schedule"
                        type="text"
                        required
                        placeholder="Schedule"
                ></b-form-input>
            </b-form-group>
            <b-button type="submit" variant="primary">Send</b-button>
            <b-button type="reset" variant="danger">Clear</b-button>
        </b-form>
    </b-modal>
</div>

<!-- Libreria Vuejs -->
<script>

    var URL_API = "https://s9jy73nwm2.execute-api.us-east-1.amazonaws.com/default/borrame_06112020";

    var app = new Vue({

        el: '#app',

        data: {
            title: "Creating New Reservation",
            editing: false,
            nuevo: {
                matricula: '',
                name: '',
                email: '',
                schedule: ''
            },
            reservations: []
        } ,

        created: function () {//representa la función de inicialización Vuejs

            console.log("Inicializando le proyecto en Vuejs: ", this.title);
        },

        mounted: function () {

            this.$nextTick(function () {  //garantizo que todos los elementos están renderizados.
                console.log("Cargando todo el render del proyecto");
                this.listaEstudiantes();
            });
        },

        methods: {

            listaEstudiantes: function(){
                console.log("Cargando lista de Estudiante");
                axios.get(URL_API).then(response => {
                    //
                    console.log("Recuperando información del servidor");
                    console.log("Objeto: "+JSON.stringify(response));
                    //
                    this.reservations = response.data.data.reservations;
                }).catch(error => { console.log(error); });
            },

            nuevoEstudiante: function(){
                console.log("Nuevo Estudiante");
                this.titulo = "Nuevo Estudiante";
                this.editando = false;
                this.limpiar();
            },

            crearActualizarEstudiante: function(){
                console.log("datos para almacenar: ", this.nuevo);
                if(!this.editando){
                    //creando
                    axios.post(URL_API, this.nuevo).then(response => {
                        this.limpiar();
                        this.listaEstudiantes();
                    }).catch(error => console.log(error));
                } else{
                    //editando
                    axios.put(URL_API, this.nuevo).then(response => {
                        this.limpiar();
                        this.listaEstudiantes();
                    }).catch(error => console.log(error));
                }

                this.$bvModal.hide('modal-1');
            },

            editarEstudiante: function (reservation) {
                console.log("El reservation seleccionado para actualizar: ", reservation);
                this.titulo = "Editando Estudiante - "+reservation.matricula;
                this.nuevo = Object.assign({}, reservation); //copiando el objeto, evitando el cambio directo en el form.
                this.editando = true;
                this.$bvModal.show('modal-1');
            },

            eliminarEstudiante: function (reservation) {
                console.log("Eliminando la matricula: ", reservation);
                axios.delete(URL_API, { data: reservation}).then(response => {
                    this.listaEstudiantes();
                }).catch(error => console.log(error));
            },

            limpiar: function () {
                this.nuevo.matricula='';
                this.nuevo.name='';
                this.nuevo.email='';
                this.nuevo.schedule='';
            }

            

        }
    });
</script>
</body>
</html>
